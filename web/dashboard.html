<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trang ch·ªß - L·ªãch th√°ng</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#9BE4FF] min-h-screen flex flex-col items-center p-4 font-sans">

  <!-- Thanh ƒëi·ªÅu h∆∞·ªõng -->
  <div class="w-full max-w-md bg-[#FFACC9] flex justify-around py-3 mb-4 rounded shadow">
    <button onclick="showTab('calendar')" class="text-white font-semibold">üìÖ L·ªäCH TR√åNH</button>
    <button onclick="showTab('eventForm')" class="text-white font-semibold">üìù S·ª∞ KI·ªÜN</button>
    <button class="text-white font-semibold">‚öôÔ∏è C√ÄI ƒê·∫∂T</button>
  </div>

  <!-- Tab: L·ªãch tr√¨nh -->
  <div id="calendarTab" class="w-full max-w-md">
    <div class="flex items-center justify-center mb-4 gap-2">
      <button class="text-2xl px-2" onclick="changeMonth(-1)">‚Üê</button>
      <h1 id="monthTitle" class="text-2xl font-bold bg-[#FFA16C] text-white px-4 py-1 rounded">TH√ÅNG 5</h1>
      <button class="text-2xl px-2" onclick="changeMonth(1)">‚Üí</button>
      <select id="yearSelect" onchange="changeYear(this.value)" class="ml-2 rounded px-2 py-1 bg-white shadow text-sm"></select>
    </div>
    <div class="grid grid-cols-4 gap-2 mb-4">
      <button class="bg-white px-4 py-1 rounded shadow text-sm font-medium">Th√°ng</button>
      <button class="bg-white px-4 py-1 rounded shadow text-sm font-medium">Tu·∫ßn</button>
      <button class="bg-white px-4 py-1 rounded shadow text-sm font-medium">NƒÉm</button>
      <button class="bg-white px-4 py-1 rounded shadow text-sm font-medium">Danh s√°ch</button>
    </div>
    <div id="calendarGrid" class="grid grid-cols-7 gap-1 text-center text-sm"></div>
  </div>

  <!-- Tab: T·∫°o s·ª± ki·ªán -->
  <div id="eventFormTab" class="w-full max-w-md hidden bg-white rounded p-4 shadow">
    <h2 class="text-xl font-bold mb-4 text-center">T·∫°o s·ª± ki·ªán</h2>
    <label class="block mb-2">Ti√™u ƒë·ªÅ:</label>
    <input id="titleInput" type="text" class="w-full border rounded p-2 mb-4" placeholder="Nh·∫≠p ti√™u ƒë·ªÅ..." />
    <label class="block mb-2">Ng√†y & Gi·ªù:</label>
    <input id="timeInput" type="datetime-local" class="w-full border rounded p-2 mb-4" />
    <label class="block mb-2">M√¥ t·∫£:</label>
    <textarea id="descInput" class="w-full border rounded p-2 mb-4" rows="3" placeholder="Chi ti·∫øt s·ª± ki·ªán"></textarea>
    <button id="saveEventBtn" class="bg-pink-400 text-white px-4 py-2 rounded w-full">L∆∞u</button>
  </div>

  <!-- Popup -->
  <div id="popup" class="hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
    <div class="bg-white p-4 rounded shadow w-80 text-center relative">
      <button onclick="closePopup()" class="absolute top-2 right-2 text-gray-500 hover:text-red-500 text-lg">&times;</button>
      <h3 class="text-xl font-bold mb-3">Chi ti·∫øt ng√†y <span id="popupDate"></span></h3>
      <div id="eventList" class="text-sm text-left text-gray-700 mb-3"></div>
      <div id="popupActions" class="flex justify-end gap-2 mt-3"></div>
    </div>
  </div>

  <script>
    let currentMonth = 4;
    let currentYear = 2025;
    let selectedDateKey = "";
    let editingKey = null;
    const monthNames = ["Th√°ng 1", "Th√°ng 2", "Th√°ng 3", "Th√°ng 4", "Th√°ng 5", "Th√°ng 6", "Th√°ng 7", "Th√°ng 8", "Th√°ng 9", "Th√°ng 10", "Th√°ng 11", "Th√°ng 12"];

    function showTab(tab) {
      document.getElementById('calendarTab').classList.add('hidden');
      document.getElementById('eventFormTab').classList.add('hidden');
      if (tab === 'calendar') {
        document.getElementById('calendarTab').classList.remove('hidden');
        renderCalendar();
      } else {
        document.getElementById('eventFormTab').classList.remove('hidden');
      }
    }

    function renderCalendar() {
      const monthTitle = document.getElementById("monthTitle");
      const calendarGrid = document.getElementById("calendarGrid");
      monthTitle.innerText = monthNames[currentMonth];

      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
      const firstDay = (new Date(currentYear, currentMonth, 1).getDay() + 6) % 7;

      calendarGrid.innerHTML = `
        <div class="font-bold">Th·ª© 2</div><div class="font-bold">Th·ª© 3</div>
        <div class="font-bold">Th·ª© 4</div><div class="font-bold">Th·ª© 5</div>
        <div class="font-bold">Th·ª© 6</div><div class="font-bold">Th·ª© 7</div>
        <div class="font-bold">CN</div>`;

      let day = 1;
      for (let i = 0; i < 42; i++) {
        const cell = document.createElement("div");
        cell.className = "min-h-[80px] bg-white rounded p-1 overflow-hidden text-left";

        if (i >= firstDay && day <= daysInMonth) {
          const key = `${currentYear}-${currentMonth + 1}-${day}`;
          const stored = localStorage.getItem(key);
          const events = stored ? JSON.parse(stored) : [];

          const content = document.createElement("div");
          content.className = "bg-[#FFD6E7] p-1 rounded h-full cursor-pointer";
          content.onclick = () => showPopup(day);

          const title = document.createElement("div");
          title.className = "font-semibold text-sm";
          title.textContent = day;
          content.appendChild(title);

          events.forEach(ev => {
            const e = document.createElement("div");
            e.className = "text-xs text-pink-800 truncate";
            e.textContent = "‚Ä¢ " + ev.title;
            content.appendChild(e);
          });

          cell.appendChild(content);
          day++;
        }

        calendarGrid.appendChild(cell);
      }
    }

    function changeMonth(delta) {
      currentMonth += delta;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      } else if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      document.getElementById("yearSelect").value = currentYear;
      renderCalendar();
    }

    function changeYear(year) {
      currentYear = parseInt(year);
      renderCalendar();
    }

    function showPopup(day) {
      const key = `${currentYear}-${currentMonth + 1}-${day}`;
      selectedDateKey = key;
      const dateDisplay = `${day}/${currentMonth + 1}/${currentYear}`;
      document.getElementById("popupDate").innerText = dateDisplay;

      const list = document.getElementById("eventList");
      const actions = document.getElementById("popupActions");
      const stored = localStorage.getItem(key);
      const events = stored ? JSON.parse(stored) : [];

      list.innerHTML = "";
      actions.innerHTML = "";

      if (events.length === 0) {
        list.innerHTML = `<p class="italic text-gray-500">Ch∆∞a c√≥ s·ª± ki·ªán n√†o.</p>`;
        const addBtn = document.createElement("button");
        addBtn.textContent = "‚ûï Th√™m s·ª± ki·ªán";
        addBtn.className = "bg-pink-400 text-white px-3 py-1 rounded text-sm";
        addBtn.onclick = () => {
          document.getElementById("timeInput").value = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}T09:00`;
          showTab("eventForm");
          closePopup();
        };
        actions.appendChild(addBtn);
      } else {
        events.forEach((e, index) => {
          const eventHTML = document.createElement("div");
          eventHTML.className = "mb-2 border-b pb-2";
          eventHTML.innerHTML = `
            <p>üìù <strong>${e.title}</strong></p>
            <p>üïí ${e.time}</p>
            <p>üìÑ ${e.description}</p>
          `;
          const btnGroup = document.createElement("div");
          btnGroup.className = "flex justify-end gap-2 mt-1";

          const editBtn = document.createElement("button");
          editBtn.textContent = "‚úèÔ∏è S·ª≠a";
          editBtn.className = "text-sm text-blue-600";
          editBtn.onclick = () => {
            document.getElementById("titleInput").value = e.title;
            document.getElementById("timeInput").value = e.time;
            document.getElementById("descInput").value = e.description;
            editingKey = { key, index };
            showTab("eventForm");
            closePopup();
          };

          const delBtn = document.createElement("button");
          delBtn.textContent = "üóëÔ∏è Xo√°";
          delBtn.className = "text-sm text-red-600";
          delBtn.onclick = () => {
            if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën xo√° s·ª± ki·ªán n√†y?")) {
              events.splice(index, 1);
              localStorage.setItem(key, JSON.stringify(events));
              renderCalendar();
              showPopup(day);
            }
          };

          btnGroup.appendChild(editBtn);
          btnGroup.appendChild(delBtn);
          eventHTML.appendChild(btnGroup);
          list.appendChild(eventHTML);
        });

        const addMoreBtn = document.createElement("button");
        addMoreBtn.textContent = "‚ûï Th√™m s·ª± ki·ªán";
        addMoreBtn.className = "bg-pink-400 text-white px-3 py-1 rounded text-sm";
        addMoreBtn.onclick = () => {
          document.getElementById("timeInput").value = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}T09:00`;
          showTab("eventForm");
          closePopup();
        };
        actions.appendChild(addMoreBtn);
      }

      document.getElementById("popup").classList.remove("hidden");
    }

    function closePopup() {
      document.getElementById("popup").classList.add("hidden");
    }

    document.getElementById("saveEventBtn").onclick = function () {
      const title = document.getElementById("titleInput").value;
      const time = document.getElementById("timeInput").value;
      const description = document.getElementById("descInput").value;

      if (!title || !time) return alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß ti√™u ƒë·ªÅ v√† th·ªùi gian.");

      const date = new Date(time);
      const key = `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
      const stored = localStorage.getItem(key);
      const events = stored ? JSON.parse(stored) : [];

      if (editingKey && editingKey.key === key) {
        events[editingKey.index] = { title, time, description };
        editingKey = null;
      } else {
        events.push({ title, time, description });
      }

      localStorage.setItem(key, JSON.stringify(events));

      document.getElementById("titleInput").value = "";
      document.getElementById("timeInput").value = "";
      document.getElementById("descInput").value = "";
      editingKey = null;

      showTab("calendar");
      renderCalendar();
    };

    const yearSelect = document.getElementById("yearSelect");
    for (let y = 2020; y <= 2030; y++) {
      const option = document.createElement("option");
      option.value = y;
      option.textContent = y;
      if (y === currentYear) option.selected = true;
      yearSelect.appendChild(option);
    }

    renderCalendar();
  </script>
</body>
</html>
