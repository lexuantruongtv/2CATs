<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trang ch·ªß - L·ªãch th√°ng</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-[#9BE4FF] min-h-screen flex flex-col items-center p-4 font-sans">

  <!-- Thanh ƒëi·ªÅu h∆∞·ªõng -->
  <div class="w-full max-w-md bg-[#FFACC9] flex justify-around py-3 mb-4 rounded shadow">
    <button onclick="showTab('calendar')" class="text-white font-semibold">üìÖ L·ªäCH TR√åNH</button>
    <button onclick="showTab('eventForm')" class="text-white font-semibold">üìù S·ª∞ KI·ªÜN</button>
    <button class="text-white font-semibold">‚öôÔ∏è C√ÄI ƒê·∫∂T</button>
  </div>

  <!-- Tab: L·ªãch tr√¨nh -->
  <div id="calendarTab" class="w-full max-w-md">
    <!-- Ti√™u ƒë·ªÅ th√°ng v√† nƒÉm -->
    <div class="flex items-center justify-center mb-4 space-x-2">
      <button class="text-2xl px-2" onclick="changeMonth(-1)">‚Üê</button>
      <h1 id="monthTitle" class="text-2xl font-bold bg-[#FFA16C] text-white px-4 py-1 rounded">TH√ÅNG 3</h1>
      <button class="text-2xl px-2" onclick="changeMonth(1)">‚Üí</button>
      <select id="yearSelect" class="ml-2 px-2 py-1 rounded" onchange="changeYear(this.value)">
        <!-- Options th√™m b·∫±ng JS -->
      </select>
    </div>

    <!-- B·∫£ng ng√†y -->
    <div id="calendarGrid" class="grid grid-cols-7 gap-1 text-center text-sm">
      <div class="font-bold">Th·ª© 2</div>
      <div class="font-bold">Th·ª© 3</div>
      <div class="font-bold">Th·ª© 4</div>
      <div class="font-bold">Th·ª© 5</div>
      <div class="font-bold">Th·ª© 6</div>
      <div class="font-bold">Th·ª© 7</div>
      <div class="font-bold">CN</div>
    </div>
  </div>

  <!-- Tab: Form t·∫°o s·ª± ki·ªán -->
  <div id="eventFormTab" class="w-full max-w-md hidden bg-white rounded p-4 shadow">
    <h2 class="text-xl font-bold mb-4 text-center">T·∫°o s·ª± ki·ªán</h2>
    <label class="block mb-2">Ti√™u ƒë·ªÅ:</label>
    <input type="text" id="eventTitle" class="w-full border rounded p-2 mb-4" placeholder="Nh·∫≠p ti√™u ƒë·ªÅ..." />
    <label class="block mb-2">Ng√†y & Gi·ªù:</label>
    <input type="datetime-local" id="eventDateTime" class="w-full border rounded p-2 mb-4" />
    <label class="block mb-2">M√¥ t·∫£:</label>
    <textarea id="eventDescription" class="w-full border rounded p-2 mb-4" rows="3" placeholder="Chi ti·∫øt s·ª± ki·ªán"></textarea>
    <button onclick="saveEvent()" class="bg-pink-400 text-white px-4 py-2 rounded w-full">L∆∞u</button>
  </div>

  <!-- Popup s·ª± ki·ªán theo ng√†y -->
  <div id="popup" class="hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
    <div class="bg-white p-4 rounded shadow w-80">
      <div class="flex justify-between mb-2 items-center">
        <h3 class="text-lg font-bold">S·ª± ki·ªán ng√†y <span id="popupDate"></span></h3>
        <button onclick="closePopup()" class="text-gray-600 text-sm">‚úñ</button>
      </div>
      <div id="eventList" class="space-y-2"></div>
      <hr class="my-2">
      <input type="text" id="newEventTitle" class="border rounded px-2 py-1 w-full mb-2" placeholder="Th√™m ti√™u ƒë·ªÅ s·ª± ki·ªán m·ªõi" />
      <button onclick="addEventToDate()" class="bg-blue-500 text-white px-3 py-1 rounded w-full">Th√™m s·ª± ki·ªán</button>
    </div>
  </div>

  <script>
    let currentMonth = 2; // Th√°ng 3 (ch·ªâ s·ªë 2)
    let currentYear = 2025;
    const events = {}; // L∆∞u s·ª± ki·ªán theo "yyyy-mm-dd"

    const monthNames = ["Th√°ng 1", "Th√°ng 2", "Th√°ng 3", "Th√°ng 4", "Th√°ng 5", "Th√°ng 6", "Th√°ng 7", "Th√°ng 8", "Th√°ng 9", "Th√°ng 10", "Th√°ng 11", "Th√°ng 12"];

    function showTab(tab) {
      document.getElementById('calendarTab').classList.add('hidden');
      document.getElementById('eventFormTab').classList.add('hidden');
      if (tab === 'calendar') {
        document.getElementById('calendarTab').classList.remove('hidden');
        renderCalendar();
      } else if (tab === 'eventForm') {
        document.getElementById('eventFormTab').classList.remove('hidden');
      }
    }

    function renderCalendar() {
      const calendarGrid = document.getElementById("calendarGrid");
      document.getElementById("monthTitle").innerText = monthNames[currentMonth];

      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
      const firstDay = new Date(currentYear, currentMonth, 1).getDay();
      const offset = (firstDay + 6) % 7; // Chuy·ªÉn Sunday t·ª´ 0 th√†nh 6

      calendarGrid.innerHTML = `
        <div class="font-bold">Th·ª© 2</div>
        <div class="font-bold">Th·ª© 3</div>
        <div class="font-bold">Th·ª© 4</div>
        <div class="font-bold">Th·ª© 5</div>
        <div class="font-bold">Th·ª© 6</div>
        <div class="font-bold">Th·ª© 7</div>
        <div class="font-bold">CN</div>
      `;

      for (let i = 0; i < offset; i++) calendarGrid.innerHTML += `<div></div>`;

      for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const eventTitles = events[dateStr]?.map(e => `<div class="text-xs text-pink-700 truncate">${e.title}</div>`).join("") || "";

        calendarGrid.innerHTML += `
          <div class="bg-[#FFD6E7] p-2 cursor-pointer text-sm rounded" onclick="showPopup('${dateStr}')">
            <div class="font-bold">${day}</div>
            ${eventTitles}
          </div>`;
      }
    }

    function changeMonth(offset) {
      currentMonth += offset;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      }
      if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar();
      updateYearDropdown();
    }

    function changeYear(year) {
      currentYear = parseInt(year);
      renderCalendar();
    }

    function updateYearDropdown() {
      const select = document.getElementById("yearSelect");
      if (select.innerHTML === "") {
        for (let y = 2020; y <= 2030; y++) {
          const opt = document.createElement("option");
          opt.value = y;
          opt.text = y;
          select.add(opt);
        }
      }
      select.value = currentYear;
    }

    function showPopup(dateStr) {
      document.getElementById("popupDate").innerText = dateStr;
      const container = document.getElementById("eventList");
      container.innerHTML = "";

      (events[dateStr] || []).forEach((ev, idx) => {
        const div = document.createElement("div");
        div.classList.add("border", "p-2", "rounded", "bg-gray-100", "relative");
        div.innerHTML = `
          <div class="font-semibold">${ev.title}</div>
          <div class="text-xs text-gray-600">${ev.desc || ""}</div>
          <div class="absolute top-1 right-1 space-x-1">
            <button class="text-blue-600 text-xs" onclick="editEvent('${dateStr}', ${idx})">S·ª≠a</button>
            <button class="text-red-600 text-xs" onclick="deleteEvent('${dateStr}', ${idx})">Xo√°</button>
          </div>`;
        container.appendChild(div);
      });

      document.getElementById("newEventTitle").value = "";
      document.getElementById("popup").classList.remove("hidden");
    }

    function closePopup() {
      document.getElementById("popup").classList.add("hidden");
    }

    function addEventToDate() {
      const dateStr = document.getElementById("popupDate").innerText;
      const title = document.getElementById("newEventTitle").value.trim();
      if (!title) return;

      if (!events[dateStr]) events[dateStr] = [];
      events[dateStr].push({ title, desc: "" });

      renderCalendar();
      showPopup(dateStr);
    }

    function editEvent(dateStr, index) {
      const newTitle = prompt("S·ª≠a ti√™u ƒë·ªÅ:", events[dateStr][index].title);
      if (newTitle !== null) {
        events[dateStr][index].title = newTitle.trim();
        renderCalendar();
        showPopup(dateStr);
      }
    }

    function deleteEvent(dateStr, index) {
      if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën xo√° s·ª± ki·ªán n√†y kh√¥ng?")) {
        events[dateStr].splice(index, 1);
        if (events[dateStr].length === 0) delete events[dateStr];
        renderCalendar();
        showPopup(dateStr);
      }
    }

    function saveEvent() {
      const title = document.getElementById("eventTitle").value.trim();
      const dateTime = document.getElementById("eventDateTime").value;
      const desc = document.getElementById("eventDescription").value.trim();

      if (!title || !dateTime) return alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");

      const [date] = dateTime.split("T");
      if (!events[date]) events[date] = [];
      events[date].push({ title, desc });

      renderCalendar();
      showTab('calendar');
    }

    updateYearDropdown();
    renderCalendar();
  </script>
</body>

</html>
